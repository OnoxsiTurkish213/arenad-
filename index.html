<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>Neon Ricochet Arena</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;user-select:none;-webkit-user-select:none}
html,body{width:100%;height:100%;overflow:hidden;background:#000;font-family:'Courier New',monospace;color:#fff;touch-action:none}
canvas#game{position:fixed;top:0;left:0;z-index:1;width:100%;height:100%}

#rotate{position:fixed;top:0;left:0;width:100%;height:100%;z-index:9999;background:#000;display:none;flex-direction:column;align-items:center;justify-content:center;font-size:16px;color:#0ff;text-align:center;padding:30px}
#rotate .ic{font-size:50px;margin-bottom:15px;animation:rota 2s ease-in-out infinite}
@keyframes rota{0%,100%{transform:rotate(0)}50%{transform:rotate(90deg)}}
@media(orientation:portrait){#rotate{display:flex!important}}

/* HUD */
#hud{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:50;display:none}
#scoreboard{position:fixed;top:8px;right:8px;z-index:55;pointer-events:none;display:none;background:rgba(0,0,0,.75);border:1px solid rgba(0,255,255,.25);border-radius:8px;padding:8px 12px;min-width:140px;backdrop-filter:blur(4px)}
#scoreboard .title{font-size:9px;color:rgba(0,255,255,.5);letter-spacing:2px;text-transform:uppercase;margin-bottom:5px;text-align:center}
#sb-list{font-size:11px}
.sb-row{display:flex;justify-content:space-between;padding:2px 0;border-bottom:1px solid rgba(255,255,255,.05)}
.sb-row .nm{color:rgba(255,255,255,.7);max-width:80px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.sb-row .kd{color:#0ff;font-weight:700;min-width:40px;text-align:right}
.sb-row.me .nm{color:#0ff}

#hp-bar{position:fixed;top:8px;left:50%;transform:translateX(-50%);z-index:55;pointer-events:none;display:none;background:rgba(0,0,0,.7);border:1px solid rgba(255,255,255,.15);border-radius:6px;padding:4px 10px;display:none;gap:6px;align-items:center}
#hp-bar .heart{font-size:18px;transition:opacity .3s}
#hp-bar .heart.dead{opacity:.15}

#kill-feed{position:fixed;top:60px;left:50%;transform:translateX(-50%);z-index:56;pointer-events:none}
.kf-msg{background:rgba(0,0,0,.7);border:1px solid rgba(255,0,100,.3);border-radius:4px;padding:4px 10px;margin-bottom:3px;font-size:10px;color:rgba(255,255,255,.7);letter-spacing:1px;animation:kfIn .3s ease,kfOut .4s ease 2s forwards;white-space:nowrap}
@keyframes kfIn{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}
@keyframes kfOut{to{opacity:0}}

#respawn-overlay{position:fixed;top:0;left:0;width:100%;height:100%;z-index:100;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.7);flex-direction:column}
#respawn-overlay .txt{font-size:28px;font-weight:900;color:#ff0066;text-shadow:0 0 20px rgba(255,0,102,.5);letter-spacing:3px}
#respawn-overlay .sub{font-size:12px;color:rgba(255,255,255,.3);margin-top:8px;letter-spacing:2px}

#ammo-ind{position:fixed;bottom:12px;left:50%;transform:translateX(-50%);z-index:55;pointer-events:none;display:none;font-size:10px;color:rgba(0,255,255,.4);letter-spacing:2px}

/* Joystick */
#joy-zone{position:fixed;bottom:10px;left:10px;z-index:60;display:none;pointer-events:all;width:160px;height:160px}
#joy-base{width:120px;height:120px;border-radius:50%;background:rgba(0,255,255,.04);border:2px solid rgba(0,255,255,.15);position:absolute;bottom:15px;left:15px}
#joy-knob{width:48px;height:48px;border-radius:50%;background:rgba(0,255,255,.15);border:2px solid rgba(0,255,255,.3);position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)}

/* Fire zone */
#fire-zone{position:fixed;top:0;right:0;width:50%;height:100%;z-index:58;display:none;pointer-events:all}

/* Menu */
#menu{position:fixed;top:0;left:0;width:100%;height:100%;z-index:200;display:flex;flex-direction:column;align-items:center;justify-content:center;background:#000}
.mbg{position:absolute;top:0;left:0;width:100%;height:100%;background-image:linear-gradient(rgba(0,255,255,.04) 1px,transparent 1px),linear-gradient(90deg,rgba(0,255,255,.04) 1px,transparent 1px);background-size:40px 40px}
.mt{font-size:clamp(24px,5vw,44px);font-weight:900;letter-spacing:4px;color:#0ff;text-shadow:0 0 30px rgba(0,255,255,.5);z-index:1;text-align:center}
.ms{font-size:clamp(9px,1.8vw,13px);letter-spacing:6px;color:rgba(255,255,255,.2);z-index:1;margin-bottom:25px;text-transform:uppercase}
.mi{background:rgba(0,255,255,.04);border:1px solid rgba(0,255,255,.25);border-radius:6px;padding:10px 16px;color:#fff;font-size:14px;width:240px;margin-bottom:8px;z-index:1;outline:none;text-align:center;font-family:inherit}
.mi:focus{border-color:rgba(0,255,255,.6)}
.mi::placeholder{color:rgba(255,255,255,.15)}
.mb{background:rgba(0,255,255,.1);border:1px solid rgba(0,255,255,.35);border-radius:6px;padding:11px 28px;color:#0ff;font-size:13px;font-weight:700;cursor:pointer;letter-spacing:2px;text-transform:uppercase;z-index:1;transition:all .3s;margin:4px;min-width:200px;font-family:inherit;pointer-events:all}
.mb:active{background:rgba(0,255,255,.25)}
.mb.sec{border-color:rgba(255,255,255,.15);color:rgba(255,255,255,.5);background:rgba(255,255,255,.03)}
#mst{margin-top:10px;font-size:10px;color:rgba(255,255,255,.25);z-index:1;min-height:14px}

/* Lobby */
#lobby{position:fixed;top:0;left:0;width:100%;height:100%;z-index:200;display:none;flex-direction:column;align-items:center;justify-content:center;background:#000}
.lc{font-size:28px;font-weight:900;letter-spacing:8px;color:#0ff;background:rgba(0,255,255,.06);border:1px solid rgba(0,255,255,.25);border-radius:6px;padding:8px 20px;margin:8px 0;z-index:1}
#plist{z-index:1;margin:12px 0;text-align:center}
.pli{font-size:11px;color:rgba(255,255,255,.45);margin:2px 0;letter-spacing:1px}
.pli.self{color:#0ff}
</style>
</head>
<body>
<div id="rotate"><div class="ic">ğŸ“±</div>LÃ¼tfen cihazÄ± yatay Ã§evirin</div>

<canvas id="game"></canvas>

<div id="hud"></div>
<div id="scoreboard"><div class="title">SKOR TABLOSU</div><div id="sb-list"></div></div>
<div id="hp-bar"></div>
<div id="kill-feed"></div>
<div id="ammo-ind"></div>
<div id="respawn-overlay"><div class="txt">ELÄ°MÄ°NE EDÄ°LDÄ°N</div><div class="sub">Yeniden doÄŸuyor...</div></div>

<div id="joy-zone"><div id="joy-base"><div id="joy-knob"></div></div></div>
<div id="fire-zone"></div>

<div id="menu">
<div class="mbg"></div>
<div class="mt">NEON RICOCHET</div>
<div class="ms">A R E N A</div>
<input type="text" id="inp-name" class="mi" placeholder="AdÄ±nÄ±z" maxlength="12">
<button class="mb" id="btn-host">âš¡ ODA KUR</button>
<input type="text" id="inp-code" class="mi" placeholder="Oda Kodu" maxlength="6" style="text-transform:uppercase;margin-top:6px">
<button class="mb sec" id="btn-join">â†’ ODAYA KATIL</button>
<div id="mst"></div>
</div>

<div id="lobby">
<div class="mbg"></div>
<div class="mt" style="font-size:22px">NEON RICOCHET ARENA</div>
<div style="font-size:9px;color:rgba(255,255,255,.2);z-index:1;margin:6px 0;letter-spacing:2px">ODA KODU</div>
<div class="lc" id="lob-code">-----</div>
<div id="plist"></div>
<div style="font-size:9px;color:rgba(255,255,255,.15);z-index:1">Kodu paylaÅŸ â€¢ 2-10 oyuncu</div>
<button class="mb" id="btn-start" style="display:none;margin-top:12px">â–¶ BAÅLAT</button>
<button class="mb sec" id="btn-leave" style="margin-top:6px">âœ• AYRIL</button>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FIREBASE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
firebase.initializeApp({
  apiKey: "AIzaSyDHIFw7LYjMTpRMpe-ONkSm91fdXk4JWY4",
    authDomain: "gravityarena-14578.firebaseapp.com",
    databaseURL: "https://gravityarena-14578-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "gravityarena-14578",
    storageBucket: "gravityarena-14578.firebasestorage.app",
    messagingSenderId: "781898977885",
    appId: "1:781898977885:web:a047f4ed10ef296bee73b4",
});
const db=firebase.database();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CONSTANTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const TILE=40;
const MAP_W=32,MAP_H=18;
const PX=MAP_W*TILE,PY=MAP_H*TILE;
const PLAYER_R=12;
const MOVE_SPD=180;
const BULLET_SPD=420;
const BULLET_R=4;
const MAX_BOUNCES=4;
const BULLET_LIFE=4;
const MAX_HP=3;
const RESPAWN_T=2000;
const SYNC_MS=45;
const LERP_F=0.18;
const FIRE_CD=400;

// Colors
const NEON_COLORS=['#00ffff','#ff00ff','#00ff88','#ffff00','#ff6600','#ff0066','#66ff00','#6600ff','#00ccff','#ff3399'];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let state='menu';
let roomId=null,myId=null,myName='Player',isHost=false;
let roomRef=null;
let cvs,ctx;

// Player
let px=200,py=200,pvx=0,pvy=0;
let myColor='#00ffff';
let hp=MAX_HP;
let alive=true;
let kills=0,deaths=0;
let lastFire=0;
let respawnTimer=0;
let invincible=false,invTimer=0;

// Joystick
let joyActive=false,joyTid=null,joyOX=0,joyOY=0,joyDX=0,joyDY=0;

// Bullets
let bullets=[];
let remoteBullets={};
let bulletIdCnt=0;

// Remote players
let rPlayers={};

// Map
let walls=[];

// Sync
let lastSync=0;

// Keyboard
let kbKeys={};

// Audio
let audioCtx=null;

// Camera
let camX=0,camY=0;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AUDIO
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function initAudio(){
  if(audioCtx)return;
  try{audioCtx=new(window.AudioContext||window.webkitAudioContext)()}catch(e){}
}

function snd(type){
  if(!audioCtx)return;
  try{
    const t=audioCtx.currentTime;
    if(type==='shoot'){
      const o=audioCtx.createOscillator(),g=audioCtx.createGain();
      o.type='sawtooth';o.frequency.setValueAtTime(600,t);o.frequency.exponentialRampToValueAtTime(200,t+0.06);
      g.gain.setValueAtTime(0.12,t);g.gain.exponentialRampToValueAtTime(0.001,t+0.08);
      o.connect(g);g.connect(audioCtx.destination);o.start(t);o.stop(t+0.08);
    }else if(type==='bounce'){
      const o=audioCtx.createOscillator(),g=audioCtx.createGain();
      o.type='sine';o.frequency.value=1000+Math.random()*500;
      g.gain.setValueAtTime(0.06,t);g.gain.exponentialRampToValueAtTime(0.001,t+0.04);
      o.connect(g);g.connect(audioCtx.destination);o.start(t);o.stop(t+0.04);
    }else if(type==='hit'){
      const o=audioCtx.createOscillator(),g=audioCtx.createGain();
      o.type='square';o.frequency.setValueAtTime(120,t);o.frequency.exponentialRampToValueAtTime(40,t+0.15);
      g.gain.setValueAtTime(0.15,t);g.gain.exponentialRampToValueAtTime(0.001,t+0.15);
      o.connect(g);g.connect(audioCtx.destination);o.start(t);o.stop(t+0.15);
    }else if(type==='kill'){
      [523,659,784].forEach((f,i)=>{
        const o=audioCtx.createOscillator(),g=audioCtx.createGain();
        o.type='sine';o.frequency.value=f;
        g.gain.setValueAtTime(0.1,t+i*0.06);g.gain.exponentialRampToValueAtTime(0.001,t+i*0.06+0.1);
        o.connect(g);g.connect(audioCtx.destination);o.start(t+i*0.06);o.stop(t+i*0.06+0.1);
      });
    }else if(type==='death'){
      const o=audioCtx.createOscillator(),g=audioCtx.createGain();
      o.type='sawtooth';o.frequency.setValueAtTime(300,t);o.frequency.exponentialRampToValueAtTime(30,t+0.4);
      g.gain.setValueAtTime(0.15,t);g.gain.exponentialRampToValueAtTime(0.001,t+0.4);
      o.connect(g);g.connect(audioCtx.destination);o.start(t);o.stop(t+0.4);
    }
  }catch(e){}
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HELPERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function genCode(){const c='ABCDEFGHJKLMNPQRSTUVWXYZ23456789';let r='';for(let i=0;i<5;i++)r+=c[Math.floor(Math.random()*c.length)];return r}
function setSt(m){document.getElementById('mst').textContent=m}
function sho(id,v){document.getElementById(id).style.display=v}

function addKF(msg){
  const el=document.getElementById('kill-feed');
  const d=document.createElement('div');d.className='kfm';d.textContent=msg;
  el.appendChild(d);setTimeout(()=>{if(d.parentNode)d.remove()},2500);
}

function notify(msg){addKF(msg)}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MAP GENERATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function generateMap(seed){
  walls=[];
  let s=seed||42;
  function sr(){s=(s*16807)%2147483647;return(s-1)/2147483646}

  // Border walls
  walls.push({x:0,y:0,w:PX,h:TILE});        // top
  walls.push({x:0,y:PY-TILE,w:PX,h:TILE});   // bottom
  walls.push({x:0,y:0,w:TILE,h:PY});          // left
  walls.push({x:PX-TILE,y:0,w:TILE,h:PY});    // right

  // Inner walls - structured grid with gaps
  const gx=4,gy=3; // grid sections
  const secW=Math.floor((MAP_W-2)/gx);
  const secH=Math.floor((MAP_H-2)/gy);

  for(let gi=0;gi<gx;gi++){
    for(let gj=0;gj<gy;gj++){
      const bx=(1+gi*secW)*TILE;
      const by=(1+gj*secH)*TILE;

      // Vertical wall segment
      if(gi>0 && sr()>0.3){
        const wLen=Math.floor(sr()*4+2);
        const wStart=Math.floor(sr()*(secH-wLen));
        for(let k=0;k<wLen;k++){
          walls.push({x:bx,y:by+wStart*TILE+k*TILE,w:TILE,h:TILE});
        }
      }

      // Horizontal wall segment
      if(gj>0 && sr()>0.3){
        const wLen=Math.floor(sr()*4+2);
        const wStart=Math.floor(sr()*(secW-wLen));
        for(let k=0;k<wLen;k++){
          walls.push({x:bx+wStart*TILE+k*TILE,y:by,w:TILE,h:TILE});
        }
      }
    }
  }

  // Random obstacles
  const numObs=15+Math.floor(sr()*15);
  for(let i=0;i<numObs;i++){
    const wx=Math.floor(sr()*(MAP_W-4)+2)*TILE;
    const wy=Math.floor(sr()*(MAP_H-4)+2)*TILE;
    const ww=TILE*(Math.floor(sr()*3)+1);
    const wh=TILE;
    // Check not overlapping spawn areas
    if(wx>TILE*3||wy>TILE*3){
      walls.push({x:wx,y:wy,w:ww,h:wh});
    }
    if(sr()>0.5){
      walls.push({x:wx,y:wy,w:TILE,h:TILE*(Math.floor(sr()*3)+1)});
    }
  }

  // L-shaped structures
  for(let i=0;i<6;i++){
    const lx=Math.floor(sr()*(MAP_W-6)+3)*TILE;
    const ly=Math.floor(sr()*(MAP_H-6)+3)*TILE;
    walls.push({x:lx,y:ly,w:TILE*3,h:TILE});
    walls.push({x:lx,y:ly,w:TILE,h:TILE*3});
  }

  console.log("[NRA] Map generated: "+walls.length+" walls, seed="+seed);
}

function isInWall(x,y,r){
  for(let i=0;i<walls.length;i++){
    const w=walls[i];
    const cx=Math.max(w.x,Math.min(x,w.x+w.w));
    const cy=Math.max(w.y,Math.min(y,w.y+w.h));
    const dx=x-cx,dy=y-cy;
    if(dx*dx+dy*dy<r*r) return true;
  }
  return false;
}

function findSpawn(){
  for(let tries=0;tries<200;tries++){
    const sx=TILE*2+Math.random()*(PX-TILE*4);
    const sy=TILE*2+Math.random()*(PY-TILE*4);
    if(!isInWall(sx,sy,PLAYER_R+4)) return{x:sx,y:sy};
  }
  return{x:PX/2,y:PY/2};
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BULLET PHYSICS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function fireBullet(fromX,fromY,dirX,dirY,owner,color){
  const len=Math.sqrt(dirX*dirX+dirY*dirY);
  if(len<0.01)return null;
  const dx=dirX/len,dy=dirY/len;

  const b={
    id:owner+'_'+(bulletIdCnt++),
    x:fromX+dx*(PLAYER_R+6),
    y:fromY+dy*(PLAYER_R+6),
    dx:dx*BULLET_SPD,
    dy:dy*BULLET_SPD,
    bounces:0,
    life:0,
    owner,
    color,
    trail:[]
  };

  bullets.push(b);
  snd('shoot');
  return b;
}

function updateBullets(dt){
  for(let i=bullets.length-1;i>=0;i--){
    const b=bullets[i];
    b.life+=dt;

    // Move
    const nx=b.x+b.dx*dt;
    const ny=b.y+b.dy*dt;

    // Wall collision
    let bounced=false;

    for(let w=0;w<walls.length;w++){
      const wall=walls[w];

      // Check if new pos inside wall
      const cx=Math.max(wall.x,Math.min(nx,wall.x+wall.w));
      const cy=Math.max(wall.y,Math.min(ny,wall.y+wall.h));
      const ddx=nx-cx,ddy=ny-cy;

      if(ddx*ddx+ddy*ddy<BULLET_R*BULLET_R){
        // Determine which side
        const overlapL=nx+BULLET_R-wall.x;
        const overlapR=wall.x+wall.w-(nx-BULLET_R);
        const overlapT=ny+BULLET_R-wall.y;
        const overlapB=wall.y+wall.h-(ny-BULLET_R);

        const minO=Math.min(
          overlapL>0?overlapL:999,
          overlapR>0?overlapR:999,
          overlapT>0?overlapT:999,
          overlapB>0?overlapB:999
        );

        if(minO===overlapL||minO===overlapR) b.dx=-b.dx;
        else b.dy=-b.dy;

        b.bounces++;
        bounced=true;
        snd('bounce');
        break;
      }
    }

    if(!bounced){
      b.x=nx;b.y=ny;
    }else{
      // Nudge out
      b.x+=b.dx*dt*0.5;
      b.y+=b.dy*dt*0.5;
    }

    // Trail
    b.trail.push({x:b.x,y:b.y,t:b.life});
    if(b.trail.length>20) b.trail.shift();

    // Hit players (only local bullets hitting remote, or remote hitting local)
    if(b.owner===myId){
      // Check vs remote players
      Object.keys(rPlayers).forEach(pid=>{
        if(pid===myId)return;
        const rp=rPlayers[pid];
        if(!rp||rp.alive===false)return;
        const rdx=b.x-(rp.renderX||rp.x),rdy=b.y-(rp.renderY||rp.y);
        if(rdx*rdx+rdy*rdy<(PLAYER_R+BULLET_R)*(PLAYER_R+BULLET_R)){
          // Hit!
          sendHit(pid);
          snd('kill');
          addKF(myName+' â†’ '+(rp.nm||'???'));
          bullets.splice(i,1);
          kills++;
          syncScore();
          return;
        }
      });
    }

    // Remote bullets hitting local player
    if(b.owner!==myId && alive && !invincible){
      const rdx=b.x-px,rdy=b.y-py;
      if(rdx*rdx+rdy*rdy<(PLAYER_R+BULLET_R)*(PLAYER_R+BULLET_R)){
        gotHit(b.owner);
        bullets.splice(i,1);
        continue;
      }
    }

    // Remove if too many bounces or lifetime
    if(b.bounces>MAX_BOUNCES||b.life>BULLET_LIFE){
      bullets.splice(i,1);
    }
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PLAYER COLLISION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function collidePlayer(){
  // Wall push-out
  for(let i=0;i<walls.length;i++){
    const w=walls[i];
    const cx=Math.max(w.x,Math.min(px,w.x+w.w));
    const cy=Math.max(w.y,Math.min(py,w.y+w.h));
    const dx=px-cx,dy=py-cy;
    const dist=Math.sqrt(dx*dx+dy*dy);
    if(dist<PLAYER_R&&dist>0.01){
      const pen=PLAYER_R-dist;
      px+=dx/dist*pen;
      py+=dy/dist*pen;
    }
  }

  // Clamp to bounds
  px=Math.max(TILE+PLAYER_R,Math.min(PX-TILE-PLAYER_R,px));
  py=Math.max(TILE+PLAYER_R,Math.min(PY-TILE-PLAYER_R,py));
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HIT / DEATH
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function sendHit(targetPid){
  if(!roomRef)return;
  roomRef.child('hits/'+targetPid).push({by:myId,t:Date.now()});
}

function gotHit(byPid){
  if(!alive||invincible)return;
  hp--;
  snd('hit');
  updateHPBar();

  if(hp<=0){
    die(byPid);
  }
}

function die(byPid){
  alive=false;
  deaths++;
  snd('death');
  syncScore();
  sho('respawn-overlay','flex');

  const killerName=rPlayers[byPid]?.nm||'???';
  addKF(killerName+' â˜  '+myName);

  if(roomRef) roomRef.child('players/'+myId+'/alive').set(false);

  respawnTimer=setTimeout(()=>{
    respawn();
  },RESPAWN_T);
}

function respawn(){
  const sp=findSpawn();
  px=sp.x;py=sp.y;
  hp=MAX_HP;
  alive=true;
  invincible=true;
  invTimer=setTimeout(()=>{invincible=false},1500);
  sho('respawn-overlay','none');
  updateHPBar();
  if(roomRef) roomRef.child('players/'+myId+'/alive').set(true);
}

function updateHPBar(){
  const bar=document.getElementById('hp-bar');
  bar.innerHTML='';
  for(let i=0;i<MAX_HP;i++){
    const h=document.createElement('span');
    h.className='heart'+(i<hp?'':' dead');
    h.textContent='â™¥';
    bar.appendChild(h);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CANVAS INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function initCanvas(){
  cvs=document.getElementById('game');
  ctx=cvs.getContext('2d');
  resizeCanvas();
  window.addEventListener('resize',resizeCanvas);
}

function resizeCanvas(){
  cvs.width=window.innerWidth;
  cvs.height=window.innerHeight;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RENDERING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function render(){
  const W=cvs.width,H=cvs.height;
  ctx.fillStyle='#050508';
  ctx.fillRect(0,0,W,H);

  // Camera follow
  const tCamX=px-W/2;
  const tCamY=py-H/2;
  camX+=(tCamX-camX)*0.12;
  camY+=(tCamY-camY)*0.12;

  ctx.save();
  ctx.translate(-camX,-camY);

  // Grid
  ctx.strokeStyle='rgba(0,255,255,0.03)';
  ctx.lineWidth=1;
  const gs=TILE;
  const sx=Math.floor(camX/gs)*gs;
  const sy=Math.floor(camY/gs)*gs;
  for(let x=sx;x<camX+W+gs;x+=gs){ctx.beginPath();ctx.moveTo(x,camY);ctx.lineTo(x,camY+H);ctx.stroke()}
  for(let y=sy;y<camY+H+gs;y+=gs){ctx.beginPath();ctx.moveTo(camX,y);ctx.lineTo(camX+W,y);ctx.stroke()}

  // Walls
  walls.forEach(w=>{
    // Skip if off screen
    if(w.x+w.w<camX-50||w.x>camX+W+50||w.y+w.h<camY-50||w.y>camY+H+50)return;

    ctx.fillStyle='#111118';
    ctx.fillRect(w.x,w.y,w.w,w.h);

    // Neon edge
    ctx.strokeStyle='rgba(0,255,255,0.2)';
    ctx.lineWidth=1.5;
    ctx.strokeRect(w.x+0.5,w.y+0.5,w.w-1,w.h-1);

    // Inner glow
    ctx.shadowColor='#0ff';
    ctx.shadowBlur=4;
    ctx.strokeStyle='rgba(0,255,255,0.08)';
    ctx.strokeRect(w.x+2,w.y+2,w.w-4,w.h-4);
    ctx.shadowBlur=0;
  });

  // Bullets
  bullets.forEach(b=>{
    // Trail
    if(b.trail.length>1){
      ctx.beginPath();
      ctx.moveTo(b.trail[0].x,b.trail[0].y);
      for(let i=1;i<b.trail.length;i++){
        ctx.lineTo(b.trail[i].x,b.trail[i].y);
      }
      ctx.strokeStyle=b.color+'44';
      ctx.lineWidth=3;
      ctx.stroke();

      ctx.strokeStyle=b.color+'88';
      ctx.lineWidth=1.5;
      ctx.stroke();
    }

    // Bullet
    ctx.beginPath();
    ctx.arc(b.x,b.y,BULLET_R,0,Math.PI*2);
    ctx.fillStyle=b.color;
    ctx.fill();

    // Glow
    ctx.shadowColor=b.color;
    ctx.shadowBlur=12;
    ctx.beginPath();
    ctx.arc(b.x,b.y,BULLET_R+1,0,Math.PI*2);
    ctx.fillStyle=b.color;
    ctx.fill();
    ctx.shadowBlur=0;
  });

  // Remote players
  Object.keys(rPlayers).forEach(pid=>{
    if(pid===myId)return;
    const rp=rPlayers[pid];
    if(!rp)return;

    // LERP
    if(rp.renderX===undefined){rp.renderX=rp.x;rp.renderY=rp.y}
    rp.renderX+=(rp.x-rp.renderX)*LERP_F;
    rp.renderY+=(rp.y-rp.renderY)*LERP_F;

    if(rp.alive===false){
      // Dead indicator
      ctx.beginPath();
      ctx.arc(rp.renderX,rp.renderY,PLAYER_R,0,Math.PI*2);
      ctx.strokeStyle='rgba(255,0,0,0.2)';
      ctx.lineWidth=1;
      ctx.stroke();
      return;
    }

    const col=rp.color||'#ff00ff';

    // Outer glow
    ctx.shadowColor=col;
    ctx.shadowBlur=15;
    ctx.beginPath();
    ctx.arc(rp.renderX,rp.renderY,PLAYER_R,0,Math.PI*2);
    ctx.strokeStyle=col;
    ctx.lineWidth=2;
    ctx.stroke();
    ctx.shadowBlur=0;

    // Fill
    ctx.beginPath();
    ctx.arc(rp.renderX,rp.renderY,PLAYER_R-2,0,Math.PI*2);
    ctx.fillStyle=col+'33';
    ctx.fill();
    ctx.strokeStyle=col;
    ctx.lineWidth=1.5;
    ctx.stroke();

    // Direction indicator
    const dirAngle=rp.ry||0;
    ctx.beginPath();
    ctx.moveTo(rp.renderX,rp.renderY);
    ctx.lineTo(rp.renderX+Math.cos(dirAngle)*PLAYER_R*1.3,rp.renderY+Math.sin(dirAngle)*PLAYER_R*1.3);
    ctx.strokeStyle=col+'88';
    ctx.lineWidth=2;
    ctx.stroke();

    // Name
    ctx.fillStyle=col+'aa';
    ctx.font='9px Courier New';
    ctx.textAlign='center';
    ctx.fillText(rp.nm||'???',rp.renderX,rp.renderY-PLAYER_R-6);
  });

  // Local player
  if(alive){
    const mc=myColor;

    // Outer glow
    ctx.shadowColor=mc;
    ctx.shadowBlur=20;
    ctx.beginPath();
    ctx.arc(px,py,PLAYER_R,0,Math.PI*2);
    ctx.strokeStyle=mc;
    ctx.lineWidth=2.5;
    ctx.stroke();
    ctx.shadowBlur=0;

    // Fill
    ctx.beginPath();
    ctx.arc(px,py,PLAYER_R-2,0,Math.PI*2);
    ctx.fillStyle=mc+'44';
    ctx.fill();
    ctx.strokeStyle=mc;
    ctx.lineWidth=2;
    ctx.stroke();

    // Inner ring
    ctx.beginPath();
    ctx.arc(px,py,PLAYER_R*0.5,0,Math.PI*2);
    ctx.fillStyle=mc+'88';
    ctx.fill();

    // Direction
    const da=yaw;
    ctx.beginPath();
    ctx.moveTo(px,py);
    ctx.lineTo(px+Math.cos(da)*PLAYER_R*1.5,py+Math.sin(da)*PLAYER_R*1.5);
    ctx.strokeStyle=mc;
    ctx.lineWidth=2;
    ctx.stroke();

    // Invincibility shield
    if(invincible){
      ctx.beginPath();
      ctx.arc(px,py,PLAYER_R+6,0,Math.PI*2);
      ctx.strokeStyle='rgba(255,255,255,0.4)';
      ctx.lineWidth=2;
      ctx.setLineDash([4,4]);
      ctx.stroke();
      ctx.setLineDash([]);
    }

    // Name
    ctx.fillStyle=mc;
    ctx.font='bold 10px Courier New';
    ctx.textAlign='center';
    ctx.fillText(myName,px,py-PLAYER_R-8);
  }

  ctx.restore();

  // Vignette
  const vg=ctx.createRadialGradient(W/2,H/2,W*0.3,W/2,H/2,W*0.7);
  vg.addColorStop(0,'transparent');
  vg.addColorStop(1,'rgba(0,0,0,0.5)');
  ctx.fillStyle=vg;
  ctx.fillRect(0,0,W,H);

  // Scanlines
  ctx.fillStyle='rgba(0,0,0,0.04)';
  for(let y=0;y<H;y+=3){
    ctx.fillRect(0,y,W,1);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INPUT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function initInput(){
  // Joystick
  const jz=document.getElementById('joy-zone');
  const jb=document.getElementById('joy-base');
  const jk=document.getElementById('joy-knob');
  const maxD=42;

  jz.addEventListener('touchstart',e=>{
    e.preventDefault();if(joyTid!==null)return;
    initAudio();
    const t=e.changedTouches[0];
    joyTid=t.identifier;
    const r=jb.getBoundingClientRect();
    joyOX=r.left+r.width/2;joyOY=r.top+r.height/2;
  },{passive:false});

  jz.addEventListener('touchmove',e=>{
    e.preventDefault();
    for(let i=0;i<e.changedTouches.length;i++){
      const t=e.changedTouches[i];
      if(t.identifier===joyTid){
        let dx=t.clientX-joyOX,dy=t.clientY-joyOY;
        const d=Math.sqrt(dx*dx+dy*dy);
        if(d>maxD){dx=dx/d*maxD;dy=dy/d*maxD}
        joyDX=dx/maxD;joyDY=dy/maxD;
        jk.style.transform=`translate(calc(-50% + ${dx}px),calc(-50% + ${dy}px))`;
      }
    }
  },{passive:false});

  const endJoy=e=>{
    for(let i=0;i<e.changedTouches.length;i++){
      if(e.changedTouches[i].identifier===joyTid){
        joyTid=null;joyDX=0;joyDY=0;
        jk.style.transform='translate(-50%,-50%)';
      }
    }
  };
  jz.addEventListener('touchend',endJoy);
  jz.addEventListener('touchcancel',endJoy);

  // Fire zone
  const fz=document.getElementById('fire-zone');

  fz.addEventListener('touchstart',e=>{
    e.preventDefault();
    initAudio();
    const t=e.changedTouches[0];
    fireAtScreen(t.clientX,t.clientY);
  },{passive:false});

  fz.addEventListener('touchmove',e=>{
    e.preventDefault();
  },{passive:false});

  // Keyboard
  document.addEventListener('keydown',e=>{kbKeys[e.code]=true});
  document.addEventListener('keyup',e=>{kbKeys[e.code]=false});

  // Mouse fire
  document.addEventListener('mousedown',e=>{
    if(state!=='playing')return;
    // Only fire if clicking on right half
    if(e.clientX>cvs.width*0.4){
      initAudio();
      fireAtScreen(e.clientX,e.clientY);
    }
  });
}

function fireAtScreen(sx,sy){
  if(!alive||state!=='playing')return;
  const now=performance.now();
  if(now-lastFire<FIRE_CD)return;
  lastFire=now;

  // Screen pos to world direction
  const worldX=sx+camX;
  const worldY=sy+camY;
  const dirX=worldX-px;
  const dirY=worldY-py;

  const b=fireBullet(px,py,dirX,dirY,myId,myColor);
  if(b){
    // Update facing direction
    yaw=Math.atan2(dirY,dirX);
    // Send to Firebase
    sendBullet(b);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PLAYER UPDATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function updatePlayer(dt){
  if(state!=='playing'||!alive)return;

  let mx=joyDX,my=joyDY;

  // Keyboard
  if(kbKeys['KeyW']||kbKeys['ArrowUp'])my=-1;
  if(kbKeys['KeyS']||kbKeys['ArrowDown'])my=1;
  if(kbKeys['KeyA']||kbKeys['ArrowLeft'])mx=-1;
  if(kbKeys['KeyD']||kbKeys['ArrowRight'])mx=1;

  const len=Math.sqrt(mx*mx+my*my);
  if(len>1){mx/=len;my/=len}

  if(len>0.1){
    yaw=Math.atan2(my,mx);
  }

  px+=mx*MOVE_SPD*dt;
  py+=my*MOVE_SPD*dt;

  collidePlayer();
  syncPlayer();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FIREBASE SYNC
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function syncPlayer(){
  if(!roomRef||state!=='playing')return;
  const now=performance.now();
  if(now-lastSync<SYNC_MS)return;
  lastSync=now;

  roomRef.child('players/'+myId).update({
    x:Math.round(px*10)/10,
    y:Math.round(py*10)/10,
    ry:Math.round(yaw*100)/100,
    alive,nm:myName,color:myColor,
    k:kills,d:deaths
  });
}

function syncScore(){
  if(!roomRef)return;
  roomRef.child('players/'+myId).update({k:kills,d:deaths});
}

function sendBullet(b){
  if(!roomRef)return;
  roomRef.child('bullets/'+b.id).set({
    x:Math.round(b.x*10)/10,
    y:Math.round(b.y*10)/10,
    dx:Math.round(b.dx*10)/10,
    dy:Math.round(b.dy*10)/10,
    owner:b.owner,
    color:b.color,
    t:Date.now()
  });

  // Auto-remove after lifetime
  setTimeout(()=>{
    if(roomRef) roomRef.child('bullets/'+b.id).remove();
  },BULLET_LIFE*1000);
}

function sendHit(targetPid){
  if(!roomRef)return;
  roomRef.child('hits/'+targetPid).push({by:myId,nm:myName,t:Date.now()});
}

function setupGameListeners(){
  // Players
  roomRef.child('players').on('value',snap=>{
    const data=snap.val()||{};
    Object.keys(data).forEach(pid=>{
      if(pid===myId)return;
      rPlayers[pid]=data[pid];
    });

    // Remove disconnected
    Object.keys(rPlayers).forEach(pid=>{
      if(!data[pid])delete rPlayers[pid];
    });

    updateScoreboard(data);
  });

  // Remote bullets
  roomRef.child('bullets').on('child_added',snap=>{
    const d=snap.val();
    if(!d||d.owner===myId)return;

    // Age check
    if(Date.now()-d.t>2000)return;

    const b={
      id:snap.key,
      x:d.x,y:d.y,
      dx:d.dx,dy:d.dy,
      bounces:0,life:0,
      owner:d.owner,
      color:d.color||'#ff00ff',
      trail:[]
    };
    bullets.push(b);
  });

  roomRef.child('bullets').on('child_removed',snap=>{
    const id=snap.key;
    const idx=bullets.findIndex(b=>b.id===id);
    if(idx>=0)bullets.splice(idx,1);
  });

  // Hits on me
  roomRef.child('hits/'+myId).on('child_added',snap=>{
    const d=snap.val();
    if(!d)return;
    // Process hit
    if(alive&&!invincible){
      gotHit(d.by);
    }
    // Remove processed hit
    snap.ref.remove();
  });
}

function updateScoreboard(data){
  const list=document.getElementById('sb-list');
  const players=Object.entries(data).map(([pid,p])=>({
    pid,nm:p.nm||'???',k:p.k||0,d:p.d||0,alive:p.alive!==false
  }));

  players.sort((a,b)=>b.k-a.k);

  list.innerHTML='';
  players.forEach(p=>{
    const row=document.createElement('div');
    row.className='sb-row'+(p.pid===myId?' me':'');
    row.innerHTML=`<span class="nm">${p.nm}${p.alive?'':'ğŸ’€'}</span><span class="kd">${p.k}K ${p.d}D</span>`;
    list.appendChild(row);
  });

  document.getElementById('players-alive').textContent='OYUNCULAR: '+players.filter(p=>p.alive).length+'/'+players.length;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LOBBY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
document.getElementById('btn-host').onclick=()=>{
  myName=document.getElementById('inp-name').value.trim()||'Player';
  roomId=genCode();
  myId='p_'+Date.now();
  isHost=true;
  roomRef=db.ref('rooms/'+roomId);

  const seed=Math.floor(Math.random()*999999);
  const colorIdx=0;
  myColor=NEON_COLORS[colorIdx];

  setSt('Oda kuruluyor...');

  roomRef.set({
    host:myId,status:'lobby',seed,
    players:{[myId]:{nm:myName,x:0,y:0,ry:0,alive:true,color:myColor,k:0,d:0,ci:colorIdx}}
  }).then(()=>{
    console.log("[NRA] Oda: "+roomId);
    document.getElementById('lob-code').textContent=roomId;
    sho('menu','none');sho('lobby','flex');
    sho('btn-start','inline-block');
    state='lobby';
    listenLobby();
  }).catch(e=>setSt('Hata: '+e.message));

  roomRef.child('players/'+myId).onDisconnect().remove();
};

document.getElementById('btn-join').onclick=()=>{
  myName=document.getElementById('inp-name').value.trim()||'Player';
  const code=document.getElementById('inp-code').value.trim().toUpperCase();
  if(!code||code.length<4){setSt('GeÃ§erli kod girin!');return}

  roomId=code;myId='p_'+Date.now();isHost=false;
  roomRef=db.ref('rooms/'+roomId);
  setSt('BaÄŸlanÄ±lÄ±yor...');

  roomRef.once('value').then(snap=>{
    const d=snap.val();
    if(!d){setSt('Oda bulunamadÄ±!');return}
    if(d.status==='playing'){setSt('Oyun baÅŸlamÄ±ÅŸ!');return}

    const pCount=d.players?Object.keys(d.players).length:0;
    if(pCount>=10){setSt('Oda dolu!');return}

    const ci=pCount%NEON_COLORS.length;
    myColor=NEON_COLORS[ci];

    roomRef.child('players/'+myId).set({
      nm:myName,x:0,y:0,ry:0,alive:true,color:myColor,k:0,d:0,ci
    }).then(()=>{
      console.log("[NRA] KatÄ±ldÄ±: "+roomId);
      document.getElementById('lob-code').textContent=roomId;
      sho('menu','none');sho('lobby','flex');
      sho('btn-start','none');
      state='lobby';
      listenLobby();
    });

    roomRef.child('players/'+myId).onDisconnect().remove();
  }).catch(e=>setSt('Hata: '+e.message));
};

function listenLobby(){
  roomRef.child('players').on('value',snap=>{
    const data=snap.val()||{};
    const list=document.getElementById('plist');
    list.innerHTML='';
    let idx=0;
    Object.keys(data).forEach(pid=>{
      const div=document.createElement('div');
      div.className='pli'+(pid===myId?' self':'');
      const col=NEON_COLORS[data[pid].ci||idx%NEON_COLORS.length];
      div.innerHTML=`<span style="color:${col}">â— </span>${data[pid].nm||'Player'}${pid===myId?' (Sen)':''}`;
      list.appendChild(div);
      idx++;
    });
  });

  roomRef.child('status').on('value',snap=>{
    if(snap.val()==='playing'&&state==='lobby'){
      roomRef.child('seed').once('value').then(s=>{
        startGame(s.val()||42);
      });
    }
  });
}

document.getElementById('btn-start').onclick=()=>{
  if(!isHost)return;
  roomRef.child('status').set('playing');
};

document.getElementById('btn-leave').onclick=()=>{
  if(roomRef)roomRef.child('players/'+myId).remove();
  roomRef=null;state='menu';
  sho('lobby','none');sho('menu','flex');
};

function backToMenu(){
  if(roomRef)roomRef.child('players/'+myId).remove();
  roomRef=null;state='menu';
  sho('menu','flex');sho('lobby','none');
  sho('hud','none');sho('scoreboard','none');sho('hp-bar','none');
  sho('joy-zone','none');sho('fire-zone','none');
  sho('ammo-ind','none');sho('respawn-overlay','none');
  bullets=[];rPlayers={};
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GAME START
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function startGame(seed){
  state='playing';
  sho('lobby','none');sho('menu','none');
  sho('hud','block');sho('scoreboard','block');
  sho('hp-bar','flex');sho('joy-zone','block');
  sho('fire-zone','block');

  hp=MAX_HP;alive=true;kills=0;deaths=0;
  invincible=true;setTimeout(()=>{invincible=false},2000);
  bullets=[];rPlayers={};

  generateMap(seed);

  const sp=findSpawn();
  px=sp.x;py=sp.y;
  camX=px-cvs.width/2;
  camY=py-cvs.height/2;

  updateHPBar();
  setupGameListeners();
  initAudio();

  console.log("[NRA] Oyun baÅŸladÄ±! Seed:"+seed);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MAIN LOOP
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let lastTime=0;
function gameLoop(time){
  requestAnimationFrame(gameLoop);
  const dt=Math.min((time-lastTime)/1000,0.05);
  lastTime=time;

  if(state==='playing'){
    updatePlayer(dt);
    updateBullets(dt);
  }

  if(cvs)render();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function init(){
  console.log("[NRA] Neon Ricochet Arena baÅŸlatÄ±lÄ±yor...");
  initCanvas();
  initInput();
  sho('menu','flex');
  requestAnimationFrame(gameLoop);
  console.log("[NRA] HazÄ±r!");
}

window.addEventListener('load',init);
</script>
</body>
</html>
